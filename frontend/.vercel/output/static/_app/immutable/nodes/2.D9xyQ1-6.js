import{s as G,n as M,r as Q,o as W}from"../chunks/B2QSKqcC.js";import{S as Y,i as Z,d as v,m as $,n as R,b as k,c as b,o as B,p as ee,q as p,e as y,f as C,r as X,h as P,g as A,j as w,l as j,k as O,s as z}from"../chunks/CU5y5L14.js";function H(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function K(s,e,t){const l=s.slice();return l[8]=e[t],l}function L(s){let e,t="Start a conversation! Ask about shipping, returns, or support hours.";return{c(){e=w("p"),e.textContent=t,this.h()},l(l){e=y(l,"P",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-q52qy6"&&(e.textContent=t),this.h()},h(){p(e,"class","text-gray-500 text-center")},m(l,r){k(l,e,r)},p:M,d(l){l&&v(e)}}}function U(s){let e,t,l=s[8].text+"",r,u,x,m;return{c(){e=w("div"),t=w("div"),r=O(l),x=j(),this.h()},l(o){e=y(o,"DIV",{class:!0});var n=C(e);t=y(n,"DIV",{class:!0});var S=C(t);r=A(S,l),S.forEach(v),x=P(n),n.forEach(v),this.h()},h(){p(t,"class",u=`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s[8].sender==="user"?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`),p(e,"class",m=`flex ${s[8].sender==="user"?"justify-end":"justify-start"}`)},m(o,n){k(o,e,n),b(e,t),b(t,r),b(e,x)},p(o,n){n&2&&l!==(l=o[8].text+"")&&z(r,l),n&2&&u!==(u=`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${o[8].sender==="user"?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"}`)&&p(t,"class",u),n&2&&m!==(m=`flex ${o[8].sender==="user"?"justify-end":"justify-start"}`)&&p(e,"class",m)},d(o){o&&v(e)}}}function F(s){let e,t;return{c(){e=w("p"),t=O(s[3]),this.h()},l(l){e=y(l,"P",{class:!0});var r=C(e);t=A(r,s[3]),r.forEach(v),this.h()},h(){p(e,"class","text-yellow-600 text-sm mb-1")},m(l,r){k(l,e,r),b(e,t)},p(l,r){r&8&&z(t,l[3])},d(l){l&&v(e)}}}function te(s){let e,t,l="Bella's Boutique Support",r,u,x,m,o,n,S,f,_,T,D,V,E=H(s[1]),d=[];for(let a=0;a<E.length;a+=1)d[a]=U(K(s,E,a));let h=null;E.length||(h=L());let g=s[3]&&F(s);return{c(){e=w("div"),t=w("h1"),t.textContent=l,r=j(),u=w("div");for(let a=0;a<d.length;a+=1)d[a].c();h&&h.c(),x=j(),g&&g.c(),m=j(),o=w("form"),n=w("textarea"),S=j(),f=w("button"),_=O("Send"),this.h()},l(a){e=y(a,"DIV",{class:!0});var c=C(e);t=y(c,"H1",{class:!0,"data-svelte-h":!0}),X(t)!=="svelte-1hklyp3"&&(t.textContent=l),r=P(c),u=y(c,"DIV",{id:!0,class:!0});var i=C(u);for(let q=0;q<d.length;q+=1)d[q].l(i);h&&h.l(i),i.forEach(v),x=P(c),g&&g.l(c),m=P(c),o=y(c,"FORM",{class:!0});var I=C(o);n=y(I,"TEXTAREA",{placeholder:!0,class:!0,rows:!0,maxlength:!0}),C(n).forEach(v),S=P(I),f=y(I,"BUTTON",{type:!0,class:!0});var N=C(f);_=A(N,"Send"),N.forEach(v),I.forEach(v),c.forEach(v),this.h()},h(){p(t,"class","text-2xl font-bold text-center my-4"),p(u,"id","chat-container"),p(u,"class","flex-1 overflow-y-auto bg-white rounded-lg shadow p-4 mb-4 space-y-4"),p(n,"placeholder","Type your message..."),p(n,"class","flex-1 border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"),p(n,"rows","1"),p(n,"maxlength","600"),n.disabled=s[2],p(f,"type","submit"),f.disabled=T=s[2]||!s[0].trim(),p(f,"class","bg-blue-600 text-white px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50"),p(o,"class","flex gap-2"),p(e,"class","flex flex-col h-screen max-w-2xl mx-auto p-4 bg-gray-50")},m(a,c){k(a,e,c),b(e,t),b(e,r),b(e,u);for(let i=0;i<d.length;i+=1)d[i]&&d[i].m(u,null);h&&h.m(u,null),b(e,x),g&&g.m(e,null),b(e,m),b(e,o),b(o,n),R(n,s[0]),b(o,S),b(o,f),b(f,_),D||(V=[B(n,"input",s[6]),B(n,"keydown",s[5]),B(o,"submit",ee(s[4]))],D=!0)},p(a,[c]){if(c&2){E=H(a[1]);let i;for(i=0;i<E.length;i+=1){const I=K(a,E,i);d[i]?d[i].p(I,c):(d[i]=U(I),d[i].c(),d[i].m(u,null))}for(;i<d.length;i+=1)d[i].d(1);d.length=E.length,!E.length&&h?h.p(a,c):E.length?h&&(h.d(1),h=null):(h=L(),h.c(),h.m(u,null))}a[3]?g?g.p(a,c):(g=F(a),g.c(),g.m(e,m)):g&&(g.d(1),g=null),c&4&&(n.disabled=a[2]),c&1&&R(n,a[0]),c&5&&T!==(T=a[2]||!a[0].trim())&&(f.disabled=T)},i:M,o:M,d(a){a&&v(e),$(d,a),h&&h.d(),g&&g.d(),D=!1,Q(V)}}}function J(){const s=document.getElementById("chat-container");s&&(s.scrollTop=s.scrollHeight)}function se(s,e,t){let l=[],r="",u=!1,x=null,m="";async function o(){if(!r.trim()||u)return;const f=r;t(0,r=""),t(2,u=!0),t(3,m=""),t(1,l=[...l,{sender:"user",text:f}]);try{const _=await fetch("/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,sessionId:x})}),T=await _.json();if(!_.ok)throw new Error(T.error||"Network error");x=T.sessionId,t(1,l=[...l,{sender:"ai",text:T.reply}])}catch{t(1,l=[...l,{sender:"ai",text:"Sorry, our agent is having trouble right now. Please try again."}])}finally{t(2,u=!1),J()}}W(()=>{const _=new URLSearchParams(window.location.search).get("sessionId");_&&(x=_),J()});function n(f){f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),o())}function S(){r=this.value,t(0,r)}return s.$$.update=()=>{s.$$.dirty&1&&(r.length>500?t(3,m="Message will be truncated to 500 characters."):t(3,m=""))},[r,l,u,m,o,n,S]}class ae extends Y{constructor(e){super(),Z(this,e,se,te,G,{})}}export{ae as component};
